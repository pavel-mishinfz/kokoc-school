# kokoc-school

# Техническое задание на проект «Дела в Порядке»

### 1. Общая концепция
«Дела в порядке» — это веб-приложение для удобного ведения списка дел. Сервис помогает пользователям не забывать о предстоящих важных событиях и задачах. <br>
После создания аккаунта, пользователь может начать вносить свои дела, деля их по проектам и указывая сроки.
Основные сценарии использования сайта: <br>
  - Создание проектов;
  - Добавление новых задач с привязкой к проекту и дате;
  - Просмотр дел на ближайшие дни;
  - Получение уведомлений о предстоящих задачах.
### 2. Техническое описание
Для разработки сайта предлагается уже готовая вёрстка, от программиста требуется лишь написать так называемый бэкенд сайта, т.е. сделать сайт динамическим, реализовать возможности по добавлению, просмотру задач и проектов. <br>
Разработка бэкенда должна вестись на языке программирования PHP 7 и выше, база данных — MySQL 5.7 и выше. <br>
Не предполагается использование языка JavaScript для клиентского программирования. <br>
При разработке схемы базы данных необходимо принимать во внимание, какие сущности необходимо хранить, их поля и возможные связи друг с другом.
### 3. Описание процессов
Процесс — это автономная операция, выполняющая полезное действие. К примеру: добавление новой задачи или регистрация аккаунта.
### 3.1. Регистрация нового аккаунта.
Выполняется после заполнения формы на странице «Регистрация аккаунта».
Последовательность действий:
  1. Проверить, что отправлена форма.
  2. Убедиться, что заполнены все обязательные поля.
  3. Проверить, что указанный email уже не используется другим пользователем.
  4. Если есть ошибки заполнения формы, то сохранить их в отдельном массиве.
  5. Если ошибок нет, то сохранить данные формы в таблице пользователей.
Если были допущены ошибки (не заполнены все поля, email занят и т.д.), то не сохранять данные, а показать ошибки в форме под соответствующими полями. <br>
Если данные были сохранены успешно, то переадресовать пользователя на главную страницу.
#### Примечания
Необходимо проверять, что значение из поля «email» действительно является валидным E-mail адресом. Для этих целей использовать встроенную функцию filter_var и фильтр FILTER_VALIDATE_EMAIL. <br>
Для хранения пароля в БД, его предварительно нужно обработать встроенной функцией password_hash.
### 3.2. Создание новой задачи
Страница доступна только аутентифицированным пользователям. <br>
Выполняется после заполнения формы на странице «Добавление задачи». <br>
Последовательность действий:
  - Проверить, что отправлена форма.
  - Убедиться, что заполнены все обязательные поля.
  - Выполнить все проверки.
  - Если есть ошибки заполнения формы, то сохранить их в отдельном массиве.
  - Если ошибок нет, то сохранить новую задачу (учитывая выбранный проект).
  - Если к задаче был прикреплен файл, то перенести его в публичную директорию и сохранить ссылку. 

При успешном сохранении формы, переадресовывать пользователя на главную страницу.
#### Список проверок
  - Проверка даты
    - Содержимое поля «дата завершения» должно быть датой в формате «ГГГГ-ММ-ДД»;
    - Эта дата должна быть больше или равна текущей.
  - Проверка проекта
    - Для идентификатора выбранного проекта проверять, что он ссылается на реально существующий проект.
  - Проверка имени задачи
    - Имя задачи не должно быть пустой строкой.
### 3.3. Авторизация на сайте
Выполняется после заполнения формы на странице «Авторизация на сайте». <br>
Последовательность действий:
  1. Проверить, что отправлена форма.
  2. Убедиться, что заполнены все обязательные поля.
  3. Если есть ошибки заполнения формы, то сохранить их в отдельном массиве.
  4. Найти в БД пользователя с переданным email.
  5. Проверить, что переданный в форме пароль совпадает с сохраненным.
  6. Если пользователь найден и пароли совпадают, то открыть новую сессию, в которую записать идентификатор пользователя.

После успешной авторизации пользователь попадает на главную страницу.
#### Примечания
Для проверки пароля использовать встроенную функцию password_verify.
### 3.4. Добавление проекта
Выполняется после заполнения формы на главной странице. <br>
Последовательность действий:
  - Проверить, что пользователь залогинен.
  - Выполнить все проверки.
  - Добавить новый проект в таблицу проектов.
#### Список проверок
  - Проверка названия проекта <br> Содержимое поля «Название проекта»:
    - не должно быть пустой строкой.
    - не должно дублировать уже существующие названия проектов для данного пользователя.
### 3.5. Уведомления о предстоящих задачах
Сервис должен уметь отправлять пользователю email уведомления о предстоящих задачах. <br>
Для каждой задачи пользователь может указать срок её выполнения в виде даты. Уведомление отправляется на email, указанный при регистрации, в дату, равную сроку выполнения задачи. <br>
Тема письма: Уведомление от сервиса «Дела в порядке» <br>
Текст письма: Уважаемый, %имя пользователя%. У вас запланирована задача %имя задачи% на %время задачи% <br>
Вся логика работы должна быть в отдельном сценарии, который будет автоматически вызываться операционной системой в начале каждых новых суток. <br>
Алгоритм работы:
  1. Выполнить SQL запрос на получение всех невыполненных задач (статус равен нулю), у которых срок равен текущему дню.
  2. Если у одного пользователя задач больше, чем одна, то объединить их названия и даты в один список, который будет вставлен в уведомление.
  3. Сформировать для каждого найденного пользователя письмо, указав тему и текст сообщения.
  4. Отправить каждому найденному пользователю это письмо.
### 3.6. Поиск
Выполняется после отправки формы поиска с главной страницы. <br>
Последовательность действий:
  1. Проверить, что была отправлена форма.
  2. Получить текст из поля поиска и убрать пробелы функцией trim.
  3. Проверить, что получившаяся строка не пустая.
  4. Выполнить поиск в таблице задач по имени задачи, используя полнотекстовый поиск (операторы «MATCH ... AGAINST»).
  5. Показать результаты поиска.
### 3.7. Выполнение задачи
Выполняется после отметки пользователем задачи как выполненной со страницы списка задач. <br>
Последовательность действий:
  1. Получить из базы задачу по её идентификатору.
  2. Составить и выполнить SQL запрос, который инвертирует статус задачи (выполнена -> не выполнена, не выполнена -> выполнена).
  3. Переадресация на страницу списка задач.
### 4. Список всех страниц
Сайт состоит из следующих страниц:
  - [Гостевая страница](#40-гостевая-страница);
  - [Главная страница](#41-главная-страница);
  - [Регистрация аккаунта](#42-регистрация-аккаунта);
  - [Авторизация на сайте](#43-авторизация-на-сайте);
  - [Добавление проекта](#44-добавление-проекта);
  - [Добавление задачи](#45-добавление-задачи).
### 4.0. Гостевая страница
Гостевая страница будет показана всем анонимным пользователям, которые впервые попали на сайт. Также на эту страницу происходит перенаправление после выхода из учетной записи. <br>
Эта страница содержит лишь параграф текста с описанием сервиса и кнопку «Зарегистрироваться», которая открывает страницу регистрации нового аккаунта.
### 4.1. Главная страница
Страница делится на две колонки в соотношении 1/3. <br>
Левая часть состоит из блока со списком проектов. Под списком проектов находится кнопка «Добавить проект», открывающая страницу добавления проекта.<br>
Правая часть относится к просмотру и управлению задачами.<br>
Состоит последовательно из следующих элементов:
  - Поиск задачи — поисковая строка, выполняющая операцию поиска по имени задачи.
  - Блок фильтров — блок, состоящий из ссылок для быстрой фильтрации задач:
    - Все задачи — показывает все задачи в выбранном проекте;
    - Повестка дня — показывает все задачи на сегодня;
    - Завтра — показывает все задачи на завтра;
    - Просроченные — показывает все задачи, которые не были выполнены и у которых истёк срок.
  - Блок задач — основной блок, который содержит список всех невыполненных задач в выбранном представлении. <br> 
    Каждая задача в блоке состоит из таких элементов (слева направо):
    - Чекбокс — показывает статус задачи: выполнена или нет;
    - Название задачи — клик по названию задачи меняет её статус;
    - Приложенный файл (если есть) — иконка-ссылка, ведущая на скачивание файла;
    - Срок выполнения (если он указан).
  - Над блоком задач должна быть ссылка «Показать выполненные», клик по которой обновляет страницу и дополняет список в выбранном представлении выполненными задачами.
  - Кнопка добавления задачи — кнопка, которая открывает страницу для добавления новой задачи.
### 4.2. Регистрация аккаунта
Чтобы пользователь имел возможность пользоваться сайтом и управлять своими задачами, ему необходимо пройти процедуру регистрации на этой странице. <br>
Форма состоит из трёх обязательных полей и кнопки «Зарегистрироваться». Форма отправляется методом «POST». <br>
|Лейбл|Тип поля|Обязательность|
|------|--------|--------------|
|E-mail|Простое текстовое поле|Да|
|Пароль|Поле типа «пароль»|Да|
|Имя|Простое текстовое поле|Да|

После заполнения формы, пользователь нажимает кнопку «Зарегистрироваться» для отправки данных формы на сервер. <br>
Сама процедура регистрации описана в отдельном разделе — [«Регистрация нового аккаунта»](#31-регистрация-нового-аккаунта). <br>
Если по итогам выполнения процесса регистрации возникли ошибки заполнения формы, то эти ошибки должны быть показаны красным текстом под необходимыми полями, а над самой кнопкой отправки формы появится сообщение «Пожалуйста, исправьте ошибки в форме».
### 4.3. Авторизация на сайте
Все поля обязательны к заполнению. <br>
Процедура авторизации описана в отдельном разделе — [«Авторизация на сайте»](#33-авторизация-на-сайте). <br>
Если по итогам выполнения процесса авторизации возникли ошибки заполнения формы, то эти ошибки должны быть показаны красным текстом под необходимыми полями, а под самой формой появится сообщение «Пожалуйста, исправьте ошибки в форме». <br>
Если пользователь ввёл неверные данные аккаунта (несуществующий пользователь или неверный пароль), то в сообщении под формой должен быть текст «Вы ввели неверный email/пароль».
### 4.4. Добавление проекта
Страница с формой для добавления нового проекта. Форма содержит только одно (обязательное) поле для указания имени нового проекта и кнопку отправки.
### 4.5. Добавление задачи
Страница с формой для добавления новой задачи. Содержит форму из четырёх полей и кнопку «Добавить».
|Лейбл|Тип поля|Обязательность|
|------|--------|--------------|
|Название|Простое текстовое поле|Да|
|Проект|Выпадающий список|Да|
|Срок выполнения|Простое текстовое поле|Да|
|Файл|Поле типа «файл»|Да|

После заполнения формы, пользователь нажимает кнопку «Добавить» для отправки данных формы на сервер. <br>
Сама процедура добавления описана в отдельном разделе — [«Создание новой задачи»](#32-создание-новой-задачи). <br>
Если по итогам выполнения процесса отправки возникли ошибки заполнения формы, то эти ошибки должны быть показаны красным текстом под необходимыми полями, а под самой формой появится сообщение «Пожалуйста, исправьте ошибки в форме».
### 5. Основные сущности
Список всех сущностей
  - [Проект](#51-проект);
  - [Задача](#52-задача);
  - [Пользователь](#53-пользователь).
### 5.1. Проект
Состоит только из названия. Каждая задача может быть привязана к одному из проектов. Проект имеет связь с пользователем, который его создал. <br>
Связи:
  - автор: пользователь, создавший проект;
### 5.2. Задача
Центральная сущность всего сайта. <br>
#### Поля:
  - дата создания: дата и время, когда задача была создана;
  - статус: число (1 или 0), означающее, была ли выполнена задача. По умолчанию ноль;
  - название: задаётся пользователем;
  - файл: ссылка на файл, загруженный пользователем;
  - срок: дата, до которой задача должна быть выполнена.
#### Связи:
  - автор: пользователь, создавший задачу;
  - проект: проект, которому принадлежит задача.
### 5.3. Пользователь
Представляет зарегистрированного пользователя. <br>
#### Поля:
  - дата регистрации: дата и время, когда этот пользователь завел аккаунт;
  - email;
  - имя;
  - пароль: хэшированный пароль пользователя.
### 6. Роли пользователей
Сайт могут использовать только зарегистрированные пользователи. <br>
Анонимный пользователь всегда видит только страницу входа на сайт.
